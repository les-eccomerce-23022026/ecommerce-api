@startuml Schema ECM - E-Commerce de Livros

!define Table(name,desc) class name as "name\n<size:10>desc</size>" << (T,#FFAAAA) >>
!define PK(name) <b>name</b>
!define FK(name) <i>name</i>
!define UK(name) <color:blue>name</color>

' =============================================================================
' DOMÍNIO: USUARIO
' Responsável por identidade, autenticação e perfil dos usuários do sistema.
' =============================================================================
package "usuario" #DDEEFF {

    Table(ecm_papel_usuario, Papéis de usuário) {
        PK(id_papel: BIGSERIAL)
        UK(dsc_papel: VARCHAR(30))
        dat_criacao: TIMESTAMPTZ
    }

    Table(ecm_usuario, Usuários do sistema) {
        PK(id_usuario: BIGSERIAL)
        UK(uuid_usuario: UUID)
        nom_usuario: VARCHAR(150)
        UK(dsc_email: VARCHAR(255))
        UK(dsc_cpf: CHAR(14))
        dsc_senha_hash: VARCHAR(255)
        FK(id_papel: INTEGER)
        flg_ativo: BOOLEAN
        dat_criacao: TIMESTAMPTZ
        dat_atualizacao: TIMESTAMPTZ
    }

    Table(ecm_perfil_cliente, Perfil de clientes) {
        PK(id_perfil_cliente: BIGSERIAL)
        UK(uuid_perfil_cliente: UUID)
        FK(id_usuario: BIGINT)
        dsc_genero: VARCHAR(30)
        dat_nascimento: DATE
        dat_criacao: TIMESTAMPTZ
        dat_atualizacao: TIMESTAMPTZ
    }
}

' =============================================================================
' DOMÍNIO: CONTATO
' Responsável pelos meios de contato do usuário (telefones).
' =============================================================================
package "contato" #DDFFD4 {

    Table(ecm_tipo_telefone, Tipos de telefone) {
        PK(id_tipo_telefone: SERIAL)
        UK(dsc_tipo_telefone: VARCHAR(30))
    }

    Table(ecm_telefone_usuario, Telefones dos usuários) {
        PK(id_telefone: BIGSERIAL)
        UK(uuid_telefone: UUID)
        FK(id_usuario: BIGINT)
        FK(id_tipo_telefone: INTEGER)
        num_ddd: CHAR(2)
        num_telefone: VARCHAR(9)
        flg_principal: BOOLEAN
        UK(id_usuario, num_ddd, num_telefone)
        dat_criacao: TIMESTAMPTZ
        dat_atualizacao: TIMESTAMPTZ
    }
}

' =============================================================================
' DOMÍNIO: ENDERECO
' Responsável pelos endereços cadastrados pelo usuário.
' =============================================================================
package "endereco" #FFF5CC {

    Table(ecm_tipo_residencia, Tipos de residência) {
        PK(id_tipo_residencia: SERIAL)
        UK(dsc_tipo_residencia: VARCHAR(50))
    }

    Table(ecm_endereco_usuario, Endereços dos usuários) {
        PK(id_endereco: BIGSERIAL)
        UK(uuid_endereco: UUID)
        FK(id_usuario: BIGINT)
        FK(id_tipo_residencia: INTEGER)
        FK(id_logradouro: INTEGER)
        dsc_complemento: VARCHAR(100)
        FK(id_cidade: INTEGER)
        FK(id_bairro: INTEGER)
        FK(id_cep: INTEGER)
        FK(id_pais: INTEGER)
        flg_principal: BOOLEAN
        dat_criacao: TIMESTAMPTZ
        dat_atualizacao: TIMESTAMPTZ
    }
}

' =============================================================================
' DOMÍNIO: LOCALIZACAO
' Responsável pela hierarquia geográfica (país → estado → cidade → bairro → CEP)
' e por logradouros normalizados.
' =============================================================================
package "localizacao" #FFE8D6 {

    Table(ecm_pais, Países) {
        PK(id_pais: SERIAL)
        UK(nom_pais: VARCHAR(80))
        dat_criacao: TIMESTAMPTZ
    }

    Table(ecm_estado_brasileiro, Estados brasileiros) {
        PK(id_estado: SERIAL)
        UK(sig_estado: CHAR(2))
        UK(nom_estado: VARCHAR(60))
    }

    Table(ecm_cidade, Cidades brasileiras) {
        PK(id_cidade: SERIAL)
        nom_cidade: VARCHAR(100)
        UK(nom_cidade_norm: VARCHAR(100))
        FK(id_estado: INTEGER)
        dat_criacao: TIMESTAMPTZ
    }

    Table(ecm_bairro, Bairros) {
        PK(id_bairro: SERIAL)
        nom_bairro: VARCHAR(100)
        UK(nom_bairro_norm: VARCHAR(100))
        FK(id_cidade: INTEGER)
        dat_criacao: TIMESTAMPTZ
    }

    Table(ecm_cep, CEPs brasileiros) {
        PK(id_cep: SERIAL)
        UK(num_cep: CHAR(8))
        FK(id_cidade: INTEGER)
        FK(id_bairro: INTEGER)
        dat_criacao: TIMESTAMPTZ
    }

    Table(ecm_tipo_logradouro, Tipos de logradouro) {
        PK(id_tipo_logradouro: SERIAL)
        UK(dsc_tipo_logradouro: VARCHAR(50))
    }

    Table(ecm_logradouro, Logradouros) {
        PK(id_logradouro: SERIAL)
        FK(id_tipo_logradouro: INTEGER)
        UK(dsc_logradouro: VARCHAR(200))
        num_logradouro: VARCHAR(10)
        dat_criacao: TIMESTAMPTZ
    }
}

' =============================================================================
' Relacionamentos
' =============================================================================

' usuario
ecm_papel_usuario ||..o{ ecm_usuario : "id_papel"
ecm_usuario ||..|| ecm_perfil_cliente : "id_usuario"

' contato
ecm_usuario ||..o{ ecm_telefone_usuario : "id_usuario"
ecm_tipo_telefone ||..o{ ecm_telefone_usuario : "id_tipo_telefone"

' endereco
ecm_usuario ||..o{ ecm_endereco_usuario : "id_usuario"
ecm_tipo_residencia ||..o{ ecm_endereco_usuario : "id_tipo_residencia"

' localizacao interna
ecm_estado_brasileiro ||..o{ ecm_cidade : "id_estado"
ecm_cidade ||..o{ ecm_bairro : "id_cidade"
ecm_cidade ||..o{ ecm_cep : "id_cidade"
ecm_bairro ||..o{ ecm_cep : "id_bairro"
ecm_tipo_logradouro ||..o{ ecm_logradouro : "id_tipo_logradouro"

' localizacao → endereco
ecm_pais ||..o{ ecm_endereco_usuario : "id_pais"
ecm_logradouro ||..o{ ecm_endereco_usuario : "id_logradouro"
ecm_cidade ||..o{ ecm_endereco_usuario : "id_cidade"
ecm_bairro ||..o{ ecm_endereco_usuario : "id_bairro"
ecm_cep ||..o{ ecm_endereco_usuario : "id_cep"

legend right
  |= Notação |= Descrição |
  | **negrito** | Chave Primária (PK) |
  | _itálico_ | Chave Estrangeira (FK) |
  | <color:blue>azul</color> | Chave Única (UK) |
  |<#DDEEFF> usuario | Identidade e acesso |
  |<#DDFFD4> contato | Meios de contato |
  |<#FFF5CC> endereco | Endereços do usuário |
  |<#FFE8D6> localizacao | Hierarquia geográfica |
endlegend

@enduml</content>
<parameter name="filePath">/home/vinicius/Downloads/estudo/fatec/lab-eng-segunda-noite/backend/sql/schema_ecm.puml